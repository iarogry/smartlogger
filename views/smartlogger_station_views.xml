<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="smartlogger_station_view_form" model="ir.ui.view">
        <field name="name">smartlogger.station.form</field>
        <field name="model">smartlogger.station</field>
        <field name="arch" type="xml">
            <form string="–°—Ç–∞–Ω—Ü—ñ—è SmartLogger">
                <header>
                    <field name="status" widget="statusbar" statusbar_visible="active,inactive,maintenance,error"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="%(action_smartlogger_data)d"
                                type="action"
                                class="oe_stat_button"
                                icon="fa-history"
                                help="–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ KPI –¥–ª—è —Ü—ñ—î—ó —Å—Ç–∞–Ω—Ü—ñ—ó."
                                context="{'default_station_id': active_id, 'search_default_station_id': active_id}">
                            <field name="kpi_data_ids" widget="statinfo" string="–Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ"/>
                        </button>

                        <button name="action_sync_data"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-refresh"
                                help="–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ —Ü—ñ—î—ó —Å—Ç–∞–Ω—Ü—ñ—ó">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏</span>
                            </div>
                        </button>
                    </div>

                    <div class="oe_title">
                        <h1><field name="name" placeholder="–ù–∞–∑–≤–∞ —Å—Ç–∞–Ω—Ü—ñ—ó..."/></h1>
                        <h3><field name="station_code" placeholder="–ö–æ–¥ —Å—Ç–∞–Ω—Ü—ñ—ó"/></h3>
                    </div>

                    <group>
                        <group string="–û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è">
                            <field name="station_code"/>
                            <field name="plant_code"/>
                            <field name="capacity"/>
                            <field name="region"/>
                            <field name="status"/>
                            <field name="last_sync"/>
                        </group>
                        <group string="–ü–æ—Ç–æ—á–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏">
                            <field name="current_power"
                                   decoration-success="current_power > 0"
                                   decoration-muted="current_power == 0"/>
                            <field name="daily_energy"/>
                            <field name="monthly_energy"/>
                            <field name="yearly_energy"/>
                            <field name="lifetime_energy"/>
                        </group>
                    </group>

                    <group>
                        <group string="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó">
                            <field name="sync_priority"/>
                            <field name="batch_group"/>
                            <field name="api_endpoint" placeholder="–ó–∞–ª–∏—à—ñ—Ç—å –ø–æ—Ä–æ–∂–Ω—ñ–º –¥–ª—è –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º"/>
                        </group>
                        <group string="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó">
                            <field name="successful_syncs" readonly="1"/>
                            <field name="sync_attempts" readonly="1"/>
                            <field name="last_error" readonly="1" attrs="{'invisible': [('last_error', '=', False)]}"/>
                        </group>
                    </group>

                    <group string="–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="o_field_widget">
                                    <span class="o_form_label">–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</span>
                                    <div class="o_field_value">
                                        <field name="current_power" invisible="1"/>
                                        <field name="capacity" invisible="1"/>
                                        <span attrs="{'invisible': [('capacity', '=', 0)]}">
                                            –†–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è...
                                        </span>
                                        <span attrs="{'invisible': [('capacity', '!=', 0)]}">
                                            –ù–µ –≤–∫–∞–∑–∞–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="o_field_widget">
                                    <span class="o_form_label">–°—Ç–∞—Ç—É—Å –∑'—î–¥–Ω–∞–Ω–Ω—è</span>
                                    <div class="o_field_value">
                                        <span class="badge badge-success" attrs="{'invisible': [('last_sync', '=', False)]}">
                                            –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ
                                        </span>
                                        <span class="badge badge-danger" attrs="{'invisible': [('last_sync', '!=', False)]}">
                                            –ù—ñ–∫–æ–ª–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞–ª–æ—Å—å
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </group>

                    <div class="alert alert-warning" role="alert" attrs="{'invisible': [('status', '!=', 'error')]}">
                        <strong>–°—Ç–∞–Ω—Ü—ñ—è –º–∞—î —Å—Ç–∞—Ç—É—Å –ø–æ–º–∏–ª–∫–∏!</strong><br/>
                        –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è API. –î–µ—Ç–∞–ª—ñ –ø–æ–º–∏–ª–∫–∏ –¥–∏–≤. —É –ø–æ–ª—ñ "–û—Å—Ç–∞–Ω–Ω—è –ø–æ–º–∏–ª–∫–∞".
                    </div>

                    <div class="alert alert-info" role="alert" attrs="{'invisible': [('last_sync', '!=', False)]}">
                        <strong>–°—Ç–∞–Ω—Ü—ñ—è —â–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞–ª–∞—Å—å</strong><br/>
                        –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∑ Huawei FusionSolar.
                    </div>
                </sheet>

                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="smartlogger_station_view_tree" model="ir.ui.view">
        <field name="name">smartlogger.station.tree</field>
        <field name="model">smartlogger.station</field>
        <field name="arch" type="xml">
            <tree string="–°—Ç–∞–Ω—Ü—ñ—ó SmartLogger"
                  decoration-success="status == 'active'"
                  decoration-info="status == 'inactive'"
                  decoration-warning="status == 'maintenance'"
                  decoration-danger="status in ['error', 'sync_error']"
                  decoration-muted="current_power == 0">

                <field name="name"/>
                <field name="station_code"/>
                <field name="region" optional="hide"/>
                <field name="status" widget="badge"
                       decoration-success="status == 'active'"
                       decoration-info="status == 'inactive'"
                       decoration-warning="status == 'maintenance'"
                       decoration-danger="status in ['error', 'sync_error']"/>
                <field name="capacity" optional="show"/>
                <field name="current_power" decoration-bf="current_power > 0"/>
                <field name="daily_energy"/>
                <field name="monthly_energy" optional="hide"/>
                <field name="yearly_energy" optional="hide"/>
                <field name="last_sync"/>
                <field name="sync_priority" optional="hide"/>
                <field name="batch_group" optional="hide"/>
                <field name="successful_syncs" optional="hide"/>
                <field name="sync_attempts" optional="hide"/>
            </tree>
        </field>
    </record>

    <record id="smartlogger_station_view_search" model="ir.ui.view">
        <field name="name">smartlogger.station.search</field>
        <field name="model">smartlogger.station</field>
        <field name="arch" type="xml">
            <search string="–ü–æ—à—É–∫ —Å—Ç–∞–Ω—Ü—ñ–π">
                <field name="name" string="–ù–∞–∑–≤–∞"/>
                <field name="station_code" string="–ö–æ–¥ —Å—Ç–∞–Ω—Ü—ñ—ó"/>
                <field name="region" string="–†–µ–≥—ñ–æ–Ω"/>

                <filter name="active_stations" string="–ê–∫—Ç–∏–≤–Ω—ñ —Å—Ç–∞–Ω—Ü—ñ—ó"
                        domain="[('status', '=', 'active')]"/>
                <filter name="inactive_stations" string="–ù–µ–∞–∫—Ç–∏–≤–Ω—ñ —Å—Ç–∞–Ω—Ü—ñ—ó"
                        domain="[('status', '=', 'inactive')]"/>
                <filter name="error_stations" string="–ó –ø–æ–º–∏–ª–∫–∞–º–∏"
                        domain="[('status', 'in', ['error', 'sync_error'])]"/>
                <filter name="maintenance_stations" string="–ù–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—ñ"
                        domain="[('status', '=', 'maintenance')]"/>

                <separator/>
                <filter name="producing_power" string="–ì–µ–Ω–µ—Ä—É—é—Ç—å –µ–Ω–µ—Ä–≥—ñ—é"
                        domain="[('current_power', '>', 0)]"/>
                <filter name="zero_power" string="–ù—É–ª—å–æ–≤–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å"
                        domain="[('current_power', '=', 0)]"/>

                <separator/>
                <filter name="never_synced" string="–ù—ñ–∫–æ–ª–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞–ª–∏—Å—å"
                        domain="[('last_sync', '=', False)]"/>
                <filter name="synced_today" string="–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞–ª–∏—Å—å —Å—å–æ–≥–æ–¥–Ω—ñ"
                        domain="[('last_sync', '>=', (context_today() + datetime.timedelta(days=0)).strftime('%Y-%m-%d 00:00:00'))]"/>

                <separator/>
                <filter name="high_priority" string="–í–∏—Å–æ–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç"
                        domain="[('sync_priority', '&lt;=', 3)]"/>
                <filter name="low_priority" string="–ù–∏–∑—å–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç"
                        domain="[('sync_priority', '&gt;=', 8)]"/>

                <group expand="0" string="–ì—Ä—É–ø—É–≤–∞—Ç–∏ –∑–∞">
                    <filter name="group_by_status" string="–°—Ç–∞—Ç—É—Å–æ–º"
                            context="{'group_by': 'status'}"/>
                    <filter name="group_by_region" string="–†–µ–≥—ñ–æ–Ω–æ–º"
                            context="{'group_by': 'region'}"/>
                    <filter name="group_by_batch_group" string="–ì—Ä—É–ø–æ—é –ø–∞–∫–µ—Ç–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏"
                            context="{'group_by': 'batch_group'}"/>
                    <filter name="group_by_sync_priority" string="–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó"
                            context="{'group_by': 'sync_priority'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="smartlogger_station_view_kanban" model="ir.ui.view">
        <field name="name">smartlogger.station.kanban</field>
        <field name="model">smartlogger.station</field>
        <field name="arch" type="xml">
            <kanban default_group_by="status">
                <field name="id"/>
                <field name="name"/>
                <field name="station_code"/>
                <field name="status"/>
                <field name="current_power"/>
                <field name="capacity"/>
                <field name="daily_energy"/>
                <field name="last_sync"/>
                <field name="region"/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="row">
                                    <div class="col-8">
                                        <strong><field name="name"/></strong><br/>
                                        <span class="text-muted"><field name="station_code"/></span>
                                        <t t-if="record.region.raw_value">
                                            | <span class="text-muted"><field name="region"/></span>
                                        </t>
                                    </div>
                                    <div class="col-4 text-right">
                                        <span class="badge"
                                              t-att-class="record.status.raw_value == 'active' ? 'badge-success' :
                                                         record.status.raw_value == 'inactive' ? 'badge-secondary' :
                                                         record.status.raw_value == 'maintenance' ? 'badge-warning' : 'badge-danger'">
                                            <field name="status"/>
                                        </span>
                                    </div>
                                </div>

                                <div class="row mt-2">
                                    <div class="col-6">
                                        <strong><field name="current_power"/> –∫–í—Ç</strong><br/>
                                        <span class="text-muted">–ü–æ—Ç–æ—á–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å</span>
                                    </div>
                                    <div class="col-6">
                                        <strong><field name="daily_energy"/> –∫–í—Ç¬∑–≥–æ–¥</strong><br/>
                                        <span class="text-muted">–°—å–æ–≥–æ–¥–Ω—ñ</span>
                                    </div>
                                </div>

                                <div class="row mt-2">
                                    <div class="col-12">
                                        <t t-if="record.capacity.raw_value > 0 and record.current_power.raw_value > 0">
                                            <div class="progress" style="height: 10px;">
                                                <div class="progress-bar bg-success" style="width: 50%">
                                                </div>
                                            </div>
                                            <small class="text-muted">
                                                –ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è
                                            </small>
                                        </t>
                                        <t t-else="">
                                            <small class="text-muted">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</small>
                                        </t>
                                    </div>
                                </div>

                                <div class="row mt-2">
                                    <div class="col-12">
                                        <small class="text-muted">
                                            –û—Å—Ç–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è:
                                            <t t-if="record.last_sync.raw_value">
                                                <field name="last_sync"/>
                                            </t>
                                            <t t-else="">
                                                –ù—ñ–∫–æ–ª–∏
                                            </t>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="action_smartlogger_station" model="ir.actions.act_window">
        <field name="name">–°—Ç–∞–Ω—Ü—ñ—ó SmartLogger</field>
        <field name="res_model">smartlogger.station</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{
            'search_default_active_stations': 1,
            'search_default_group_by_status': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                –¢—É—Ç –±—É–¥—É—Ç—å –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è –≤–∞—à—ñ —Å—Ç–∞–Ω—Ü—ñ—ó SmartLogger
            </p>
            <p>
                –°—Ç–∞–Ω—Ü—ñ—ó –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ–º–ø–æ—Ä—Ç—É—é—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∑ Huawei FusionSolar API.<br/>
                –Ø–∫—â–æ —Å—Ç–∞–Ω—Ü—ñ—ó –≤—ñ–¥—Å—É—Ç–Ω—ñ, –∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –≤ —Ä–æ–∑–¥—ñ–ª—ñ "–û–ø–µ—Ä–∞—Ü—ñ—ó".
            </p>
            <p>
                <strong>–°—Ç–∞—Ç—É—Å–∏ —Å—Ç–∞–Ω—Ü—ñ–π:</strong><br/>
                üü¢ <strong>–ê–∫—Ç–∏–≤–Ω–∞</strong> - –≥–µ–Ω–µ—Ä—É—î –µ–Ω–µ—Ä–≥—ñ—é<br/>
                üîµ <strong>–ù–µ–∞–∫—Ç–∏–≤–Ω–∞</strong> - –Ω–µ –≥–µ–Ω–µ—Ä—É—î –µ–Ω–µ—Ä–≥—ñ—é (–Ω—ñ—á, —Ö–º–∞—Ä–Ω—ñ—Å—Ç—å)<br/>
                üü° <strong>–û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è</strong> - –Ω–∞ —Ç–µ—Ö–Ω—ñ—á–Ω–æ–º—É –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—ñ<br/>
                üî¥ <strong>–ü–æ–º–∏–ª–∫–∞</strong> - –ø—Ä–æ–±–ª–µ–º–∏ –∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º –∞–±–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é<br/>
            </p>
        </field>
    </record>
</odoo>