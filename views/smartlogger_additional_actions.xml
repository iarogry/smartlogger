<?xml version="1.0" encoding="utf-8"?>
<!-- –§–ê–ô–õ: views/smartlogger_additional_actions.xml -->
<!-- –°–û–ó–î–ê–¢–¨ –ù–û–í–´–ô –§–ê–ô–õ! (—ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–µ—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ) -->

<odoo>
    <!-- ========================================== -->
    <!-- –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø –î–õ–Ø SMARTLOGGER   -->
    <!-- ========================================== -->

    <!-- ==========================================
         –î–ï–ô–°–¢–í–ò–Ø –î–õ–Ø –û–ö–û–ù (ir.actions.act_window)
         ========================================== -->

    <!-- Kanban –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–π -->
    <record id="action_smartlogger_station_kanban" model="ir.actions.act_window">
        <field name="name">–°—Ç–∞–Ω—Ü—ñ—ó SmartLogger (Kanban)</field>
        <field name="res_model">smartlogger.station</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'search_default_group_by_status': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Kanban –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏—Ö —Å—Ç–∞–Ω—Ü—ñ–π SmartLogger
            </p>
            <p>
                –¢—É—Ç –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ –≤—Å—ñ —Å—Ç–∞–Ω—Ü—ñ—ó, –∑–≥—Ä—É–ø–æ–≤–∞–Ω—ñ –∑–∞ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –¥–ª—è –∑—Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è.
            </p>
        </field>
    </record>

    <!-- –°—Ç–∞–Ω—Ü–∏–∏ —Å –æ—à–∏–±–∫–∞–º–∏ -->
    <record id="action_smartlogger_error_stations" model="ir.actions.act_window">
        <field name="name">–°—Ç–∞–Ω—Ü—ñ—ó –∑ –ø–æ–º–∏–ª–∫–∞–º–∏</field>
        <field name="res_model">smartlogger.station</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('status', 'in', ['error', 'sync_error'])]</field>
        <field name="context">{'search_default_error_stations': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                –°—Ç–∞–Ω—Ü—ñ—ó –∑ –ø–æ–º–∏–ª–∫–∞–º–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ!
            </p>
            <p>
                –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤—Å—ñ –≤–∞—à—ñ —Å—Ç–∞–Ω—Ü—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó.
            </p>
        </field>
    </record>

    <!-- –í—ã–±–æ—Ä–æ—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è -->
    <record id="action_manual_sync_wizard" model="ir.actions.act_window">
        <field name="name">–í–∏–±—ñ—Ä–∫–æ–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è</field>
        <field name="res_model">smartlogger.sync.data.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_sync_mode': 'data_only'}</field>
    </record>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Cron –∑–∞–¥–∞–Ω–∏—è–º–∏ -->
    <record id="action_smartlogger_cron_jobs" model="ir.actions.act_window">
        <field name="name">–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è SmartLogger</field>
        <field name="res_model">ir.cron</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('name', 'ilike', 'SmartLogger')]</field>
        <field name="context">{'create': False, 'delete': False}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º–∏ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏ SmartLogger
            </p>
            <p>–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ:</p>
            <ul>
                <li>–£–≤—ñ–º–∫–Ω—É—Ç–∏/–≤–∏–º–∫–Ω—É—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é</li>
                <li>–ó–º—ñ–Ω–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</li>
                <li>–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç–∞—Ç—É—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å</li>
                <li>–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è</li>
            </ul>
        </field>
    </record>

    <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <record id="action_smartlogger_advanced_config" model="ir.actions.act_window">
        <field name="name">–†–æ–∑—à–∏—Ä–µ–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</field>
        <field name="res_model">ir.config_parameter</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('key', 'ilike', 'huawei.fusionsolar%')]</field>
        <field name="context">{'create': True, 'delete': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                –†–æ–∑—à–∏—Ä–µ–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è SmartLogger
            </p>
            <p>
                <strong>–£–≤–∞–≥–∞!</strong> –ó–º—ñ–Ω—é–π—Ç–µ —Ü—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Ä–æ–∑—É–º—ñ—î—Ç–µ —ó—Ö –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è.
            </p>
            <p>
                –¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∞–±–æ –∑–º—ñ–Ω–∏—Ç–∏ —ñ—Å–Ω—É—é—á—ñ.
            </p>
        </field>
    </record>

    <!-- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
    <record id="action_smartlogger_cleanup_data" model="ir.actions.act_window">
        <field name="name">–û—á–∏—â–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –¥–∞–Ω–∏—Ö</field>
        <field name="res_model">smartlogger.sync.data.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_sync_mode': 'data_only', 'cleanup_mode': True}</field>
    </record>

    <!-- –°–±—Ä–æ—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ API -->
    <record id="action_reset_api_block" model="ir.actions.server">
        <field name="name">–°–∫–∏–Ω—É—Ç–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è API</field>
        <field name="model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="state">code</field>
        <field name="code">
# –°–±—Ä–∞—Å—ã–≤–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É API
try:
    result = env['smartlogger.station'].reset_api_block()
    if result:
        raise UserWarning('–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è API —Å–∫–∏–Ω—É—Ç–æ —É—Å–ø—ñ—à–Ω–æ! –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ.')
    else:
        raise UserWarning('–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è API —Å–∫–∏–Ω—É—Ç–æ.')
except Exception as e:
    raise UserError('–ü–æ–º–∏–ª–∫–∞ —Å–∫–∏–¥–∞–Ω–Ω—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è: %s' % str(e))
        </field>
    </record>

    <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API -->
    <record id="action_check_api_status" model="ir.actions.server">
        <field name="name">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å API</field>
        <field name="model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="state">code</field>
        <field name="code">
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å API –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
IrConfigParameter = env['ir.config_parameter'].sudo()

api_blocked = IrConfigParameter.get_param('huawei.fusionsolar.api_blocked', 'false') == 'true'
auth_error_count = int(IrConfigParameter.get_param('huawei.fusionsolar.auth_error_count', '0'))
last_auth_error = IrConfigParameter.get_param('huawei.fusionsolar.last_auth_error', '')
last_auth_error_time = IrConfigParameter.get_param('huawei.fusionsolar.last_auth_error_time', '')
last_successful_sync = IrConfigParameter.get_param('huawei.fusionsolar.last_successful_sync', '')
block_reason = IrConfigParameter.get_param('huawei.fusionsolar.block_reason', '')

info_lines = []
info_lines.append('=== –°–¢–ê–¢–£–° FUSIONSOLAR API ===')
info_lines.append('')

if api_blocked:
    info_lines.append('üî¥ –°—Ç–∞—Ç—É—Å API: –ó–ê–ë–õ–û–ö–û–í–ê–ù–ò–ô')
    info_lines.append('üìã –ü—Ä–∏—á–∏–Ω–∞: %s' % (block_reason or '–ù–µ–≤—ñ–¥–æ–º–æ'))
else:
    info_lines.append('üü¢ –°—Ç–∞—Ç—É—Å API: –ê–∫—Ç–∏–≤–Ω–∏–π')

info_lines.append('üìä –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó: %d' % auth_error_count)

if last_auth_error:
    info_lines.append('‚ùå –û—Å—Ç–∞–Ω–Ω—è –ø–æ–º–∏–ª–∫–∞: %s' % last_auth_error)
    if last_auth_error_time:
        info_lines.append('‚è∞ –ß–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –ø–æ–º–∏–ª–∫–∏: %s' % last_auth_error_time)

if last_successful_sync:
    info_lines.append('‚úÖ –û—Å—Ç–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è: %s' % last_successful_sync)

info_lines.append('')
if api_blocked:
    info_lines.append('üí° –î–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏:')
    info_lines.append('   1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ API')
    info_lines.append('   2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°–∫–∏–Ω—É—Ç–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è API"')
else:
    info_lines.append('üí° API –ø—Ä–∞—Ü—é—î –Ω–æ—Ä–º–∞–ª—å–Ω–æ')

message = '\n'.join(info_lines)
raise UserError(message)
        </field>
    </record>

    <!-- ==========================================
         URL –î–ï–ô–°–¢–í–ò–Ø (ir.actions.act_url)
         ========================================== -->

    <!-- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API -->
    <record id="action_smartlogger_api_docs" model="ir.actions.act_url">
        <field name="name">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è Huawei FusionSolar API</field>
        <field name="url">https://forum.huawei.com/enterprise/en/communicate-with-fusionsolar-through-an-openapi-account/thread/591478-100027</field>
        <field name="target">new</field>
    </record>

    <!-- ==========================================
         –°–ï–†–í–ï–†–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø (ir.actions.server)
         ========================================== -->

    <!-- –ë—ã—Å—Ç—Ä–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å—Ç–∞–Ω—Ü–∏–π -->
    <record id="server_action_quick_sync_all" model="ir.actions.server">
        <field name="name">–®–≤–∏–¥–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –≤—Å—ñ—Ö —Å—Ç–∞–Ω—Ü—ñ–π</field>
        <field name="model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
# –ó–∞–ø—É—Å–∫ –±—ã—Å—Ç—Ä–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞–Ω—Ü–∏–π
try:
    result = env['smartlogger.station'].sync_fusionsolar_data()
    if result.get('success'):
        raise UserError('–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!')
    else:
        raise UserError('–ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó: %s' % result.get('message', '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'))
except Exception as e:
    raise UserError('–ü–æ–º–∏–ª–∫–∞: %s' % str(e))
        </field>
    </record>

    <!-- –ü–æ–º–µ—Ç–∏—Ç—å —Å—Ç–∞–Ω—Ü–∏–∏ –∫–∞–∫ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏ -->
    <record id="server_action_mark_maintenance" model="ir.actions.server">
        <field name="name">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ "–ù–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—ñ"</field>
        <field name="model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
# –ü–æ–º–µ—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏ –∫–∞–∫ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏
records.write({'status': 'maintenance'})
raise UserError('–í–∏–±—Ä–∞–Ω—ñ —Å—Ç–∞–Ω—Ü—ñ—ó –ø–æ–∑–Ω–∞—á–µ–Ω–æ —è–∫ "–ù–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—ñ"')
        </field>
    </record>

    <!-- –°–±—Ä–æ—Å –æ—à–∏–±–æ–∫ —Å—Ç–∞–Ω—Ü–∏–π -->
    <record id="server_action_reset_errors" model="ir.actions.server">
        <field name="name">–°–∫–∏–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫–∏</field>
        <field name="model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
# –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ —Å—Ç–∞–Ω—Ü–∏–π —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏
error_stations = records.filtered(lambda r: r.status in ['error', 'sync_error'])
if error_stations:
    error_stations.write({
        'status': 'active',
        'last_error': False
    })
    raise UserError('–ü–æ–º–∏–ª–∫–∏ —Å–∫–∏–Ω—É—Ç–æ –¥–ª—è %d —Å—Ç–∞–Ω—Ü—ñ–π' % len(error_stations))
else:
    raise UserError('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Å—Ç–∞–Ω—Ü—ñ–π –∑ –ø–æ–º–∏–ª–∫–∞–º–∏ —Å–µ—Ä–µ–¥ –≤–∏–±—Ä–∞–Ω–∏—Ö')
        </field>
    </record>

    <!-- –ü—Ä–æ—Å—Ç–æ–π —ç–∫—Å–ø–æ—Ä—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞–Ω—Ü–∏—è—Ö -->
    <record id="server_action_show_station_info" model="ir.actions.server">
        <field name="name">–ü–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å—Ç–∞–Ω—Ü—ñ—ó</field>
        <field name="model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏—è—Ö
# –ï—Å–ª–∏ records –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ (–≤—ã–∑–æ–≤ –∏–∑ –º–µ–Ω—é), –±–µ—Ä–µ–º –≤—Å–µ —Å—Ç–∞–Ω—Ü–∏–∏
stations = records if records else model.search([])

if not stations:
    raise UserError('–°—Ç–∞–Ω—Ü—ñ—ó –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!')

info_lines = []
if records:
    info_lines.append('=== –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø –ü–†–û –í–ò–ë–†–ê–ù–Ü –°–¢–ê–ù–¶–Ü–á ===')
else:
    info_lines.append('=== –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø –ü–†–û –í–°–Ü –°–¢–ê–ù–¶–Ü–á ===')
info_lines.append('')

for station in stations:
    info_lines.append('–°—Ç–∞–Ω—Ü—ñ—è: %s' % station.name)
    info_lines.append('  –ö–æ–¥: %s' % station.station_code)
    info_lines.append('  –°—Ç–∞—Ç—É—Å: %s' % station.status)
    info_lines.append('  –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å: %.2f –∫–í—Ç' % station.current_power)
    info_lines.append('  –î–æ–±–æ–≤–∞ –µ–Ω–µ—Ä–≥—ñ—è: %.2f –∫–í—Ç¬∑–≥–æ–¥' % station.daily_energy)
    if station.last_sync:
        info_lines.append('  –û—Å—Ç–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è: %s' % station.last_sync)
    info_lines.append('')

info_lines.append('–ó–∞–≥–∞–ª–æ–º —Å—Ç–∞–Ω—Ü—ñ–π: %d' % len(stations))
total_power = sum(stations.mapped('current_power'))
total_energy = sum(stations.mapped('daily_energy'))
info_lines.append('–ó–∞–≥–∞–ª—å–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å: %.2f –∫–í—Ç' % total_power)
info_lines.append('–ó–∞–≥–∞–ª—å–Ω–∞ –¥–æ–±–æ–≤–∞ –µ–Ω–µ—Ä–≥—ñ—è: %.2f –∫–í—Ç¬∑–≥–æ–¥' % total_energy)

# –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
message = '\n'.join(info_lines)
raise UserError(message)
        </field>
    </record>

    <!-- –ú–∞—Å—Å–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
    <record id="server_action_set_priority" model="ir.actions.server">
        <field name="name">–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤–∏—Å–æ–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</field>
        <field name="model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
records.write({'sync_priority': 1})
raise UserError('–î–ª—è %d —Å—Ç–∞–Ω—Ü—ñ–π –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤–∏—Å–æ–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó' % len(records))
        </field>
    </record>

    <!-- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏–π -->
    <record id="server_action_force_sync" model="ir.actions.server">
        <field name="name">–ü—Ä–∏–º—É—Å–æ–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è</field>
        <field name="model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏–π
try:
    # –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ç—É—Å
    records.write({
        'last_sync': fields.Datetime.now(),
        'status': 'active'
    })
    raise UserError('–ü—Ä–∏–º—É—Å–æ–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–∞ –¥–ª—è %d —Å—Ç–∞–Ω—Ü—ñ–π' % len(records))
except Exception as e:
    raise UserError('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏–º—É—Å–æ–≤–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó: %s' % str(e))
        </field>
    </record>

    <!-- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π –ø–æ —Ä–µ–≥–∏–æ–Ω—É -->
    <record id="server_action_group_by_region" model="ir.actions.server">
        <field name="name">–ì—Ä—É–ø—É–≤–∞—Ç–∏ –∑–∞ —Ä–µ–≥—ñ–æ–Ω–∞–º–∏</field>
        <field name="model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_model_id" ref="smartlogger.model_smartlogger_station"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
# –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å—Ç–∞–Ω—Ü–∏–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
# –ï—Å–ª–∏ records –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ (–≤—ã–∑–æ–≤ –∏–∑ –º–µ–Ω—é), –±–µ—Ä–µ–º –≤—Å–µ —Å—Ç–∞–Ω—Ü–∏–∏
stations = records if records else model.search([])

if not stations:
    raise UserError('–°—Ç–∞–Ω—Ü—ñ—ó –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!')

regions = {}
for station in stations:
    region = station.region or '–ë–µ–∑ —Ä–µ–≥—ñ–æ–Ω—É'
    if region not in regions:
        regions[region] = []
    regions[region].append(station.name)

info_lines = []
if records:
    info_lines.append('=== –ì–†–£–ü–£–í–ê–ù–ù–Ø –í–ò–ë–†–ê–ù–ò–• –°–¢–ê–ù–¶–Ü–ô –ó–ê –†–ï–ì–Ü–û–ù–ê–ú–ò ===')
else:
    info_lines.append('=== –ì–†–£–ü–£–í–ê–ù–ù–Ø –í–°–Ü–• –°–¢–ê–ù–¶–Ü–ô –ó–ê –†–ï–ì–Ü–û–ù–ê–ú–ò ===')
info_lines.append('')

for region, station_names in regions.items():
    info_lines.append('%s (%d —Å—Ç–∞–Ω—Ü—ñ–π):' % (region, len(station_names)))
    for name in station_names:
        info_lines.append('  ‚Ä¢ %s' % name)
    info_lines.append('')

message = '\n'.join(info_lines)
raise UserError(message)
    </field>
    </record>

</odoo>